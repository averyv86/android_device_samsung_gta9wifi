# Copyright (C) 2024 The LineageOS Project
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.

import /vendor/etc/init/hw/init.mt6789.usb.rc

on early-init
    mount debugfs debugfs /sys/kernel/debug
    chmod 0755 /sys/kernel/debug

on init
    # Set permissions for MediaTek-specific nodes
    chown system system /sys/devices/platform/boot/boot_mode
    chown system system /sys/devices/platform/boot/meta_mode

    # ZRAM setup
    write /proc/sys/vm/page-cluster 0

on boot
    # MediaTek power management
    chown system system /sys/power/state
    chown system system /sys/power/wake_lock
    chown system system /sys/power/wake_unlock
    chmod 0660 /sys/power/state
    chmod 0660 /sys/power/wake_lock
    chmod 0660 /sys/power/wake_unlock

    # WiFi
    mkdir /data/vendor/wifi 0770 wifi wifi
    mkdir /data/vendor/wifi/wpa 0770 wifi wifi
    mkdir /data/vendor/wifi/wpa/sockets 0770 wifi wifi

service vendor.wifi_hal_legacy /vendor/bin/hw/android.hardware.wifi@1.0-service
    class hal
    capabilities NET_ADMIN NET_RAW SYS_MODULE
    user wifi
    group wifi inet net_admin net_raw

on property:sys.boot_completed=1
    # Enable power saving mode
    write /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor "schedutil"
